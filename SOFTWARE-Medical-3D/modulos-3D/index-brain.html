<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cerebro 3D - Plataforma M√©dica In Silico</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap');
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--bg:#080b12;--panel:rgba(12,16,28,0.88);--card:rgba(18,24,42,0.75);--accent:#e8675a;--accent-glow:rgba(232,103,90,0.25);--cyan:#5cc8d4;--cyan-glow:rgba(92,200,212,0.2);--text:#e8ecf4;--text2:#8a94a8;--dim:#555f73;--border:rgba(255,255,255,0.06);--glass:rgba(255,255,255,0.03)}
        body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;overflow:hidden;height:100vh}
        .header{position:fixed;top:0;left:0;right:0;height:52px;background:var(--panel);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 20px;z-index:100}
        .header h1{font-size:.9rem;font-weight:600;letter-spacing:-.02em}
        .header span{font-family:'Space Mono',monospace;font-size:.6rem;color:var(--dim);text-transform:uppercase;letter-spacing:.1em}
        .header-r{display:flex;align-items:center;gap:14px}
        .sdot{width:6px;height:6px;border-radius:50%;background:#4ade80;box-shadow:0 0 8px rgba(74,222,128,.5);animation:pd 2s infinite}
        @keyframes pd{0%,100%{opacity:1}50%{opacity:.5}}
        .fps{font-family:'Space Mono',monospace;font-size:.68rem;color:var(--dim)}
        #brainCanvas{position:fixed;top:52px;left:0;width:100%;height:calc(100vh - 52px)}
        .loading-screen{position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1000;transition:opacity .8s,visibility .8s}
        .loading-screen.hidden{opacity:0;visibility:hidden;pointer-events:none}
        .lb-icon{font-size:3.5rem;animation:fl 2s ease-in-out infinite}
        @keyframes fl{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
        .lb-bar{width:180px;height:2px;background:var(--border);border-radius:2px;margin-top:20px;overflow:hidden}
        .lb-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--cyan));width:0%;transition:width .3s;border-radius:2px}
        .lb-txt{font-family:'Space Mono',monospace;font-size:.68rem;color:var(--dim);margin-top:10px}
        .info-panel{position:fixed;top:66px;right:14px;width:280px;background:var(--panel);backdrop-filter:blur(24px);border:1px solid var(--border);border-radius:14px;padding:18px;z-index:50;transition:transform .4s cubic-bezier(.16,1,.3,1),opacity .4s}
        .info-panel.hide{transform:translateX(300px);opacity:0}
        .ip-tag{font-size:.6rem;font-family:'Space Mono',monospace;text-transform:uppercase;letter-spacing:.12em;color:var(--accent);margin-bottom:10px}
        .ip-name{font-size:1.3rem;font-weight:700;letter-spacing:-.03em;margin-bottom:3px}
        .ip-sys{font-size:.78rem;color:var(--cyan);margin-bottom:10px}
        .ip-desc{font-size:.78rem;line-height:1.5;color:var(--text2);margin-bottom:14px}
        .ip-stats{display:grid;grid-template-columns:1fr 1fr;gap:7px}
        .st-card{background:var(--glass);border:1px solid var(--border);border-radius:9px;padding:9px 10px}
        .st-label{font-size:.6rem;color:var(--dim);font-family:'Space Mono',monospace;text-transform:uppercase;letter-spacing:.05em}
        .st-val{font-size:.85rem;font-weight:600;margin-top:1px}
        .hl-panel{position:fixed;top:66px;left:14px;background:var(--panel);backdrop-filter:blur(24px);border:1px solid var(--border);border-radius:13px;padding:12px;z-index:50}
        .hl-title{font-size:.6rem;font-family:'Space Mono',monospace;text-transform:uppercase;letter-spacing:.1em;color:var(--dim);margin-bottom:8px}
        .hl-btn{display:flex;align-items:center;gap:8px;width:100%;padding:7px 10px;border:1px solid transparent;border-radius:7px;background:0 0;color:var(--text2);font-size:.78rem;font-family:'DM Sans',sans-serif;cursor:pointer;transition:all .2s;margin-bottom:2px}
        .hl-btn:hover{background:var(--glass);color:var(--text)}
        .hl-btn.active{background:var(--cyan-glow);border-color:rgba(92,200,212,.3);color:var(--cyan)}
        .hl-dot{width:7px;height:7px;border-radius:50%}
        .ctrl-bar{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);display:flex;gap:5px;background:var(--panel);backdrop-filter:blur(24px);border:1px solid var(--border);border-radius:13px;padding:7px;z-index:50}
        .cb{width:40px;height:40px;border-radius:9px;border:1px solid transparent;background:0 0;color:var(--text2);font-size:1.05rem;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center}
        .cb:hover{background:var(--glass);border-color:var(--border);color:var(--text)}
        .cb.active{background:var(--accent-glow);border-color:var(--accent);color:var(--accent)}
        .cd{width:1px;background:var(--border);margin:4px 1px}
        .pp-panel{position:fixed;bottom:75px;left:50%;transform:translateX(-50%);background:var(--panel);backdrop-filter:blur(24px);border:1px solid var(--border);border-radius:13px;padding:14px;z-index:50;min-width:220px;display:none}
        .pp-panel.vis{display:block}
        .pp-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:7px}
        .pp-row label{font-size:.72rem;color:var(--text2)}
        .pp-row input[type=range]{width:100px;height:3px;-webkit-appearance:none;background:var(--border);border-radius:2px;outline:0}
        .pp-row input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:11px;height:11px;border-radius:50%;background:var(--accent);cursor:pointer}
        .credit{position:fixed;bottom:70px;right:14px;font-size:.55rem;color:var(--dim);font-family:'Space Mono',monospace;z-index:50;text-align:right;line-height:1.4}
        .credit a{color:var(--dim);text-decoration:underline;text-decoration-color:rgba(255,255,255,.1)}

        /* ‚ïê‚ïê‚ïê AGREGADO: Back button ‚ïê‚ïê‚ïê */
        .back-btn{
            display:flex;align-items:center;gap:7px;
            padding:0 12px;height:32px;
            background:rgba(255,255,255,0.04);
            border:1px solid rgba(255,255,255,0.06);
            border-radius:8px;
            color:var(--text2);
            font-family:'DM Sans',sans-serif;
            font-size:.75rem;font-weight:500;
            cursor:pointer;
            transition:all .25s ease;
            text-decoration:none;
            flex-shrink:0;
        }
        .back-btn:hover{
            background:rgba(255,255,255,0.08);
            border-color:rgba(255,255,255,0.12);
            color:var(--text);
        }
        .back-btn svg{
            width:14px;height:14px;
            opacity:.6;transition:all .25s ease;
        }
        .back-btn:hover svg{opacity:1;transform:translateX(-2px)}

        /* ‚ïê‚ïê‚ïê AGREGADO: Labels toggle style ‚ïê‚ïê‚ïê */
        .cb.lbl-active{
            background:var(--accent-glow) !important;
            border-color:var(--accent) !important;
            color:var(--accent) !important;
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="ls">
        <div class="lb-icon">üß†</div>
        <div class="lb-bar"><div class="lb-fill" id="lbFill"></div></div>
        <div class="lb-txt" id="lbTxt">Inicializando...</div>
    </div>

    <div class="header">
        <div style="display:flex;align-items:center;gap:10px">
            <!-- ‚ïê‚ïê‚ïê AGREGADO: Bot√≥n atr√°s ‚ïê‚ïê‚ïê -->
            <a href="../index.html" class="back-btn" title="Volver a m√≥dulos">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><polyline points="12 19 5 12 12 5"/></svg>
            </a>
            <span style="font-size:1.3rem">üß¨</span>
            <div><h1>Plataforma M√©dica In Silico</h1><span>Modelo Anat√≥mico 3D ‚Äî Cerebro Humano</span></div>
        </div>
        <div class="header-r"><div class="fps" id="fps">-- FPS</div><div class="sdot"></div></div>
    </div>

    <canvas id="brainCanvas"></canvas>

    <div class="hl-panel">
        <div class="hl-title">Estructuras</div>
        <button class="hl-btn active" data-part="all"><span class="hl-dot" style="background:#d4a0a0"></span>Cerebro completo</button>
        <button class="hl-btn" data-part="cerebrum"><span class="hl-dot" style="background:#e8a090"></span>Corteza cerebral</button>
        <button class="hl-btn" data-part="cerebellum"><span class="hl-dot" style="background:#c89888"></span>Cerebelo</button>
        <button class="hl-btn" data-part="brainstem"><span class="hl-dot" style="background:#b89080"></span>Tronco encef√°lico</button>
    </div>

    <div class="info-panel" id="ip">
        <div class="ip-tag">Informaci√≥n Anat√≥mica</div>
        <div class="ip-name" id="ipN">Cerebro Humano</div>
        <div class="ip-sys" id="ipS">Sistema Nervioso Central</div>
        <div class="ip-desc" id="ipD">Centro de control del cuerpo. Compuesto por hemisferios cerebrales, cerebelo y tronco encef√°lico. Procesa informaci√≥n sensorial, motora, cognitiva y emocional.</div>
        <div class="ip-stats" id="ipSt">
            <div class="st-card"><div class="st-label">Peso</div><div class="st-val">~1.4 kg</div></div>
            <div class="st-card"><div class="st-label">Neuronas</div><div class="st-val">~86√ó10‚Åπ</div></div>
            <div class="st-card"><div class="st-label">Consumo O‚ÇÇ</div><div class="st-val">20%</div></div>
            <div class="st-card"><div class="st-label">L√≥bulos</div><div class="st-val">4 √ó hemisf.</div></div>
        </div>
    </div>

    <div class="ctrl-bar">
        <button class="cb active" id="bRot" title="Auto-rotaci√≥n">üîÑ</button>
        <button class="cb" id="bRst" title="Reset">üè†</button>
        <div class="cd"></div>
        <button class="cb" id="bZi" title="Zoom +">‚ûï</button>
        <button class="cb" id="bZo" title="Zoom -">‚ûñ</button>
        <div class="cd"></div>
        <button class="cb" id="bFr" title="Frontal">üë§</button>
        <button class="cb" id="bTo" title="Superior">‚¨ÜÔ∏è</button>
        <button class="cb" id="bSi" title="Lateral">üëà</button>
        <div class="cd"></div>
        <button class="cb" id="bPP" title="Efectos">‚ú®</button>
        <button class="cb" id="bIn" title="Info">üìã</button>
        <div class="cd"></div>
        <!-- ‚ïê‚ïê‚ïê AGREGADO: Bot√≥n toggle etiquetas ‚ïê‚ïê‚ïê -->
        <button class="cb lbl-active" id="bLbl" title="Etiquetas num√©ricas">üè∑Ô∏è</button>
    </div>

    <div class="pp-panel" id="ppP">
        <div class="hl-title">Post-Processing</div>
        <div class="pp-row"><label>Bloom</label><input type="range" id="ppB" min="0" max="100" value="15"></div>
        <div class="pp-row"><label>Exposici√≥n</label><input type="range" id="ppE" min="50" max="200" value="120"></div>
        <div class="pp-row"><label>SSS</label><input type="range" id="ppS" min="0" max="100" value="30"></div>
        <div class="pp-row"><label>Vignette</label><input type="range" id="ppV" min="0" max="100" value="30"></div>
    </div>

    <div class="credit">Modelo: <a href="https://sketchfab.com/3d-models/human-brain-c9c9d4d671b94345952d012cc2ea7a24" target="_blank">"Human Brain"</a> por agher08<br>CC-BY-4.0</div>

    <script type="importmap">
    {"imports":{"three":"https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.module.js","three/addons/":"https://cdn.jsdelivr.net/npm/three@0.152.2/examples/jsm/"}}
    </script>
    <script type="module">
import * as THREE from 'three';
import {GLTFLoader} from 'three/addons/loaders/GLTFLoader.js';
import {OrbitControls} from 'three/addons/controls/OrbitControls.js';
import {EffectComposer} from 'three/addons/postprocessing/EffectComposer.js';
import {RenderPass} from 'three/addons/postprocessing/RenderPass.js';
import {UnrealBloomPass} from 'three/addons/postprocessing/UnrealBloomPass.js';
import {ShaderPass} from 'three/addons/postprocessing/ShaderPass.js';
import {SMAAPass} from 'three/addons/postprocessing/SMAAPass.js';

const $=id=>document.getElementById(id);
const lbFill=$('lbFill'), lbTxt=$('lbTxt'), ls=$('ls');
const setLoad=(p,t)=>{lbFill.style.width=p+'%';lbTxt.textContent=t};

// ===== SCENE =====
setLoad(10,'Configurando escena...');
const canvas=$('brainCanvas');
const scene=new THREE.Scene();
scene.background=new THREE.Color(0x080b12);
scene.fog=new THREE.FogExp2(0x080b12, 0.06);

const camera=new THREE.PerspectiveCamera(45, innerWidth/(innerHeight-52), 0.1, 100);
camera.position.set(3, 2, 4);

const renderer=new THREE.WebGLRenderer({canvas, antialias:true, powerPreference:'high-performance'});
renderer.setSize(innerWidth, innerHeight-52);
renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
renderer.shadowMap.enabled=true;
renderer.shadowMap.type=THREE.PCFSoftShadowMap;
renderer.toneMapping=THREE.ACESFilmicToneMapping;
renderer.toneMappingExposure=1.2;
renderer.outputColorSpace=THREE.SRGBColorSpace;
renderer.useLegacyLights=false;

// ===== ORBIT CONTROLS =====
const ctrl=new OrbitControls(camera, canvas);
ctrl.enableDamping=true; ctrl.dampingFactor=0.06;
ctrl.rotateSpeed=0.7; ctrl.zoomSpeed=0.8;
ctrl.minDistance=2; ctrl.maxDistance=12;
ctrl.target.set(0, -0.8, -0.5);
ctrl.autoRotate=true; ctrl.autoRotateSpeed=0.8;

// ===== ENVIRONMENT MAP =====
setLoad(20,'Generando environment...');
const pmrem=new THREE.PMREMGenerator(renderer);
pmrem.compileEquirectangularShader();
const envSc=new THREE.Scene();
envSc.add(new THREE.Mesh(
    new THREE.SphereGeometry(10, 32, 32),
    new THREE.ShaderMaterial({
        side: THREE.BackSide,
        vertexShader:`varying vec3 vP;void main(){vP=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}`,
        fragmentShader:`varying vec3 vP;void main(){
            vec3 d=normalize(vP);float y=d.y*.5+.5;
            vec3 c=mix(vec3(.05,.06,.08),mix(vec3(.1,.12,.18),vec3(.15,.18,.25),smoothstep(.4,1.,y)),smoothstep(0.,.4,y));
            c+=vec3(.3,.15,.1)*pow(max(0.,dot(d,normalize(vec3(1.,.3,.5)))),8.)*.3;
            c+=vec3(.1,.15,.25)*pow(max(0.,dot(d,normalize(vec3(-.8,.2,-.5)))),6.)*.2;
            gl_FragColor=vec4(c,1.);}`
    })
));
scene.environment=pmrem.fromScene(envSc, 0.04).texture;
pmrem.dispose();

// ===== LIGHTS =====
setLoad(30,'Iluminaci√≥n...');
scene.add(new THREE.HemisphereLight(0x8090b0, 0x332211, 0.4));

const keyLight=new THREE.DirectionalLight(0xffeedd, 3.0);
keyLight.position.set(4, 6, 4);
keyLight.castShadow=true;
keyLight.shadow.mapSize.set(2048, 2048);
keyLight.shadow.camera.near=0.1;
keyLight.shadow.camera.far=20;
keyLight.shadow.camera.left=-3;
keyLight.shadow.camera.right=3;
keyLight.shadow.camera.top=3;
keyLight.shadow.camera.bottom=-3;
keyLight.shadow.bias=-0.0005;
keyLight.shadow.normalBias=0.02;
scene.add(keyLight);

const fillLight=new THREE.DirectionalLight(0x6688bb, 1.2);
fillLight.position.set(-5, 3, -2);
scene.add(fillLight);

const rimLight=new THREE.DirectionalLight(0xffc8a0, 1.5);
rimLight.position.set(-1, -2, -5);
scene.add(rimLight);

const topLight=new THREE.DirectionalLight(0xddeeff, 0.6);
topLight.position.set(0, 8, 0);
scene.add(topLight);

const specLight=new THREE.PointLight(0xffffff, 1.0, 15);
specLight.position.set(2, 3, 3);
scene.add(specLight);

const sssLight=new THREE.PointLight(0xff8866, 0.5, 10);
sssLight.position.set(0, -3, 2);
scene.add(sssLight);

// ===== POST-PROCESSING =====
setLoad(40,'Post-processing...');
const composer=new EffectComposer(renderer);
composer.addPass(new RenderPass(scene, camera));

const bloom=new UnrealBloomPass(
    new THREE.Vector2(innerWidth, innerHeight), 0.15, 0.6, 0.85
);
composer.addPass(bloom);

const cgShader={
    uniforms:{tDiffuse:{value:null}, sss:{value:0.3}, vign:{value:0.3}},
    vertexShader:`varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}`,
    fragmentShader:`uniform sampler2D tDiffuse;uniform float sss;uniform float vign;varying vec2 vUv;
    void main(){
        vec4 tx=texture2D(tDiffuse,vUv);vec3 c=tx.rgb;
        float lum=dot(c,vec3(.299,.587,.114));
        float sm=smoothstep(.1,.5,lum)*(1.-smoothstep(.5,.9,lum));
        c+=vec3(.9,.45,.35)*sss*sm*.15;
        c.r+=.03;c.b-=.015;
        float g=dot(c,vec3(.2126,.7152,.0722));c=mix(vec3(g),c,1.1);
        c=(c-.5)*1.05+.5;
        vec2 u=vUv*2.-1.;c*=1.-dot(u,u)*vign*.4;
        gl_FragColor=vec4(clamp(c,0.,1.),tx.a);}`
};
const cgPass=new ShaderPass(cgShader);
composer.addPass(cgPass);
composer.addPass(new SMAAPass(innerWidth, innerHeight));

// ===== LOAD BRAIN =====
setLoad(50,'Cargando cerebro...');
let brainModel=null;
const parts={cerebrum:null, cerebellum:null, brainstem:null};

new GLTFLoader().load('brain.glb',
    (gltf)=>{
        setLoad(80,'Materiales PBR...');
        brainModel=gltf.scene;

        // Center and scale
        const box=new THREE.Box3().setFromObject(brainModel);
        const center=box.getCenter(new THREE.Vector3());
        const size=box.getSize(new THREE.Vector3());
        const sc=3.0/Math.max(size.x, size.y, size.z);
        brainModel.scale.setScalar(sc);

        // Reposition after scaling
        const scaledBox=new THREE.Box3().setFromObject(brainModel);
        const scaledCenter=scaledBox.getCenter(new THREE.Vector3());
        brainModel.position.x -= scaledCenter.x;
        brainModel.position.y -= scaledCenter.y;
        brainModel.position.z -= scaledCenter.z;

        // Enhance materials
        brainModel.traverse((child)=>{
            if(!child.isMesh) return;
            child.castShadow=true;
            child.receiveShadow=true;

            const mat=child.material;
            const mn=(mat.name||'').toLowerCase();

            const pm=new THREE.MeshPhysicalMaterial();
            if(mat.map) pm.map=mat.map;
            if(mat.normalMap){pm.normalMap=mat.normalMap; pm.normalScale=new THREE.Vector2(1.5,1.5)}
            if(mat.roughnessMap) pm.roughnessMap=mat.roughnessMap;
            if(mat.metalnessMap) pm.metalnessMap=mat.metalnessMap;

            pm.roughness=0.65; pm.metalness=0;
            pm.clearcoat=0.15; pm.clearcoatRoughness=0.4;
            pm.thickness=0.5;
            pm.attenuationColor=new THREE.Color(0.85,0.45,0.38);
            pm.attenuationDistance=2.0;
            pm.sheen=0.25; pm.sheenRoughness=0.5;
            pm.sheenColor=new THREE.Color(0.8,0.5,0.45);
            pm.emissive=new THREE.Color(0.15,0.06,0.05);
            pm.emissiveIntensity=0.08;
            pm.envMapIntensity=0.6;

            if(mn.includes('brain_low')||mn.includes('1001')){
                parts.cerebrum=child; pm.normalScale.set(1.8,1.8); pm.clearcoat=0.2;
            }else if(mn.includes('cerebellum')||mn.includes('1003')){
                parts.cerebellum=child; pm.roughness=0.7; pm.normalScale.set(2.0,2.0);
            }else if(mn.includes('stem')||mn.includes('1002')){
                parts.brainstem=child; pm.roughness=0.55; pm.clearcoat=0.1;
            }
            child.material=pm;
        });

        scene.add(brainModel);

        // Ground plane
        const gnd=new THREE.Mesh(
            new THREE.PlaneGeometry(20,20),
            new THREE.MeshStandardMaterial({color:0x080b12, roughness:0.95, transparent:true, opacity:0.5})
        );
        gnd.rotation.x=-Math.PI/2;
        gnd.position.y=-2.5;
        gnd.receiveShadow=true;
        scene.add(gnd);

        setLoad(100,'¬°Listo!');
        setTimeout(()=>ls.classList.add('hidden'), 500);
    },
    (p)=>{if(p.total) setLoad(50+(p.loaded/p.total)*30, 'Descargando... '+(p.loaded/1024|0)+'KB')},
    (e)=>{console.error(e); setLoad(0,'Error al cargar. Verifica que brain.glb est√© en la misma carpeta.')}
);

// ‚ïê‚ïê‚ïê AGREGADO: Exponer engine para m√≥dulo de etiquetas ‚ïê‚ïê‚ïê
window.__BRAIN3D = { scene, camera, renderer, ctrl };

// ===== ANIMATION =====
let lt=performance.now(), fc=0;
(function anim(t){
    requestAnimationFrame(anim);
    fc++;
    if(t-lt>=1000){$('fps').textContent=fc+' FPS';fc=0;lt=t}
    ctrl.update();
    sssLight.intensity=0.5+Math.sin(t*0.001*0.8)*0.1;
    composer.render();
})(0);

// ===== RESIZE =====
addEventListener('resize',()=>{
    const w=innerWidth, h=innerHeight-52;
    camera.aspect=w/h; camera.updateProjectionMatrix();
    renderer.setSize(w,h); composer.setSize(w,h); bloom.setSize(w,h);
});

// ===== UI CONTROLS =====
let ar=true;
$('bRot').onclick=e=>{ar=!ar;ctrl.autoRotate=ar;e.currentTarget.classList.toggle('active',ar)};
$('bRst').onclick=()=>{ctrl.target.set(0,-.8,-.5);camera.position.set(3,2,4)};
$('bZi').onclick=()=>camera.position.lerp(ctrl.target, 0.15);
$('bZo').onclick=()=>{const d=camera.position.clone().sub(ctrl.target).normalize();camera.position.add(d.multiplyScalar(0.5))};
$('bFr').onclick=()=>{camera.position.set(0,-.5,5);ctrl.target.set(0,-.8,-.5)};
$('bTo').onclick=()=>{camera.position.set(0,6,0);ctrl.target.set(0,-.8,-.5)};
$('bSi').onclick=()=>{camera.position.set(5,-.5,-.5);ctrl.target.set(0,-.8,-.5)};

let ipVis=true;
$('bIn').onclick=()=>{ipVis=!ipVis;$('ip').classList.toggle('hide',!ipVis)};

$('bPP').onclick=e=>{$('ppP').classList.toggle('vis');e.currentTarget.classList.toggle('active')};
$('ppB').oninput=e=>bloom.strength=e.target.value/100*0.5;
$('ppE').oninput=e=>renderer.toneMappingExposure=e.target.value/100;
$('ppS').oninput=e=>cgPass.uniforms.sss.value=e.target.value/100;
$('ppV').oninput=e=>cgPass.uniforms.vign.value=e.target.value/100;

// ===== HIGHLIGHT PARTS =====
const partInfo={
    all:{n:'Cerebro Humano',s:'Sistema Nervioso Central',d:'Centro de control del cuerpo. Compuesto por hemisferios cerebrales, cerebelo y tronco encef√°lico. Procesa informaci√≥n sensorial, motora, cognitiva y emocional.',st:[{l:'Peso',v:'~1.4 kg'},{l:'Neuronas',v:'~86√ó10‚Åπ'},{l:'Consumo O‚ÇÇ',v:'20%'},{l:'L√≥bulos',v:'4 √ó hemisf.'}]},
    cerebrum:{n:'Corteza Cerebral',s:'Telenc√©falo',d:'Capa externa de los hemisferios. Responsable del pensamiento, percepci√≥n, lenguaje, memoria y control motor voluntario. Sus circunvoluciones aumentan la superficie.',st:[{l:'Espesor',v:'2-4 mm'},{l:'Superficie',v:'~2500 cm¬≤'},{l:'Neuronas',v:'~16√ó10‚Åπ'},{l:'L√≥bulos',v:'F, P, T, O'}]},
    cerebellum:{n:'Cerebelo',s:'Metenc√©falo',d:'Coordina movimientos, equilibrio, postura y aprendizaje motor. Contiene m√°s de la mitad de las neuronas del cerebro total.',st:[{l:'Peso',v:'~150 g'},{l:'Neuronas',v:'~50√ó10‚Åπ'},{l:'Volumen',v:'~10% total'},{l:'Capas',v:'3 corticales'}]},
    brainstem:{n:'Tronco Encef√°lico',s:'Mesenc√©falo + Puente + Bulbo',d:'Conecta cerebro con m√©dula espinal. Controla funciones vitales: respiraci√≥n, ritmo card√≠aco, presi√≥n arterial y ciclos de sue√±o.',st:[{l:'Longitud',v:'~7.5 cm'},{l:'Partes',v:'3 regiones'},{l:'N. craneales',v:'10 de 12'},{l:'Funci√≥n',v:'Vital/aut√≥n.'}]}
};

document.querySelectorAll('.hl-btn').forEach(btn=>{
    btn.onclick=()=>{
        document.querySelectorAll('.hl-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const p=btn.dataset.part, info=partInfo[p];
        $('ipN').textContent=info.n; $('ipS').textContent=info.s; $('ipD').textContent=info.d;
        $('ipSt').innerHTML=info.st.map(s=>`<div class="st-card"><div class="st-label">${s.l}</div><div class="st-val">${s.v}</div></div>`).join('');
        
        if(parts.cerebrum && parts.cerebellum && parts.brainstem){
            [parts.cerebrum, parts.cerebellum, parts.brainstem].forEach(m=>{
                if(!m||!m.material) return;
                const isTarget = p==='all' || m===parts[p];
                m.material.opacity = isTarget ? 1 : 0.15;
                m.material.transparent = !isTarget;
                m.material.emissiveIntensity = isTarget ? (p==='all' ? 0.08 : 0.18) : 0.02;
            });
        }
    };
});
    </script>
    <!-- ‚ïê‚ïê‚ïê AGREGADO: M√≥dulo de Etiquetas Anat√≥micas Numeradas ‚ïê‚ïê‚ïê -->
    <script type="module" src="../js/labels/brain/brain_labels.js"></script>
    <script type="module" src="../js/labels/brain/brain_medical_info.js"></script>

    <script type="module" src="js/brain/brain_core.js"></script>
    <script type="module" src="js/brain/brain_environment.js"></script>
    <script type="module" src="js/brain/brain_postprocessing.js"></script>
    <script type="module" src="js/brain/brain_loader.js"></script>
    <script type="module" src="js/brain/brain_animation.js"></script>
    <script type="module" src="js/brain/brain_ui.js"></script>
    <script type="module" src="js/brain/brain_highlight.js"></script>
</body>
</html>